# Story 1.2: Custom Exception Classes

## Status
Done

## Story
**As a** developer implementing GitIngest Agent modules,
**I want** a custom exception hierarchy for application errors,
**so that** I can handle errors consistently across all modules with clear error types.

## Acceptance Criteria
1. GitIngestAgentError base exception class created
2. Four specialized exception classes created (GitIngestError, ValidationError, StorageError, WorkflowError)
3. Each exception class has clear docstring explaining its purpose
4. Exception hierarchy properly inherits from base class
5. Unit tests verify exception hierarchy and instantiation

## Tasks / Subtasks

- [x] **Task 1: Create exceptions module** (AC: 1, 2, 3, 4)
  - [x] Create exceptions.py file at project root
  - [x] Implement GitIngestAgentError base class with docstring
  - [x] Implement GitIngestError(GitIngestAgentError) for GitIngest CLI failures
  - [x] Implement ValidationError(GitIngestAgentError) for input validation failures
  - [x] Implement StorageError(GitIngestAgentError) for file system operation failures
  - [x] Implement WorkflowError(GitIngestAgentError) for workflow logic errors

- [x] **Task 2: Write unit tests for exceptions** (AC: 5)
  - [x] Create tests/test_exceptions.py
  - [x] Test base exception instantiation
  - [x] Test all specialized exceptions inherit from base
  - [x] Test exception messages are preserved
  - [x] Test exceptions can be raised and caught correctly
  - [x] Test isinstance checks work for exception hierarchy

## Dev Notes

### Architecture Overview
This story creates the foundation for error handling across all modules. All core modules (token_counter, workflow, extractor, storage, cli) will use these exceptions to signal specific error types.

[Source: architecture.md#5.1 Error Hierarchy]

### Error Hierarchy Design

**Exception Hierarchy:**
```python
Exception (Python built-in)
  └── GitIngestAgentError (base for all application errors)
       ├── GitIngestError (GitIngest CLI execution failures)
       ├── ValidationError (Input validation failures)
       ├── StorageError (File system operation failures)
       └── WorkflowError (Workflow logic errors)
```
[Source: architecture.md#5.1]

### Exception Definitions

**GitIngestAgentError (Base Class):**
- Purpose: Base exception for all GitIngest Agent errors
- Use: Allows catching all application errors with single except clause
- Example: `except GitIngestAgentError as e:` catches all custom errors

**GitIngestError:**
- Purpose: Raised when GitIngest CLI execution fails
- Common causes: Network errors, invalid URLs, repository not found, timeouts
- Used by: extractor.py, token_counter.py modules
- Example: `raise GitIngestError(f"Repository not found: {url}")`

**ValidationError:**
- Purpose: Raised when input validation fails
- Common causes: Invalid GitHub URL format, invalid content type
- Used by: workflow.py module (URL validation)
- Example: `raise ValidationError(f"Invalid GitHub URL: {url}")`

**StorageError:**
- Purpose: Raised when file system operations fail
- Common causes: Permission denied, disk full, invalid path
- Used by: storage.py module
- Example: `raise StorageError(f"Cannot create directory: {path}")`

**WorkflowError:**
- Purpose: Raised when workflow logic encounters unexpected state
- Common causes: Invalid routing decision, configuration errors
- Used by: workflow.py, cli.py modules
- Example: `raise WorkflowError("Token count unavailable for routing decision")`

[Source: architecture.md#5.1, #5.2]

### Implementation Pattern

**Basic Exception Structure:**
```python
class GitIngestAgentError(Exception):
    """Base exception for all GitIngest Agent errors."""
    pass

class GitIngestError(GitIngestAgentError):
    """Raised when GitIngest CLI execution fails."""
    pass

class ValidationError(GitIngestAgentError):
    """Raised when input validation fails."""
    pass

class StorageError(GitIngestAgentError):
    """Raised when file system operations fail."""
    pass

class WorkflowError(GitIngestAgentError):
    """Raised when workflow logic encounters unexpected state."""
    pass
```

**Why Simple Implementation:**
- Phase 1 doesn't require complex exception attributes
- Standard Python exception message handling is sufficient
- Can be enhanced later if needed (error codes, retry logic, etc.)
[Source: architecture.md#11.1 Simplicity First]

### Usage Examples (for reference)

**In token_counter.py:**
```python
from exceptions import GitIngestError, ValidationError

def count_tokens(url: str) -> int:
    try:
        result = subprocess.run(['gitingest', url, '-o', '-'], ...)
    except subprocess.CalledProcessError as e:
        raise GitIngestError(f"GitIngest failed: {e.stderr}")
    except subprocess.TimeoutExpired:
        raise GitIngestError("Token counting timed out")
```

**In workflow.py:**
```python
from exceptions import ValidationError

def validate_github_url(url: str) -> tuple[str, str]:
    pattern = r'https?://github\.com/([\w-]+)/([\w-]+)'
    if not re.match(pattern, url):
        raise ValidationError(f"Invalid GitHub URL: {url}")
```

[Source: architecture.md#5.2]

### File Location

**Created in this story:**
- `exceptions.py` at project root (same level as cli.py, storage.py, etc.)

**Test file:**
- `tests/test_exceptions.py`

[Source: architecture.md#TR3 Project Structure]

### Design Decisions

**Why separate exceptions.py file:**
- Central location for all exception definitions
- Avoids circular import issues
- Makes exception hierarchy visible in one place
- Follows Python best practices for exception organization

**Why simple inheritance only:**
- Phase 1 proven design doesn't require complex exceptions
- Can add error codes, retry logic, etc. in future if needed
- YAGNI principle - implement what's needed now
[Source: architecture.md#11.1 Design Principles]

## Testing

### Testing Standards

**Test File Location:**
- `tests/test_exceptions.py`

**Testing Framework:**
- Use pytest framework
- No mocking required (testing pure Python classes)

**Test Coverage:**
```python
# Test cases to implement:
def test_base_exception_instantiation():
    """Test GitIngestAgentError can be created with message."""

def test_git_ingest_error_inheritance():
    """Test GitIngestError inherits from GitIngestAgentError."""

def test_validation_error_inheritance():
    """Test ValidationError inherits from GitIngestAgentError."""

def test_storage_error_inheritance():
    """Test StorageError inherits from GitIngestAgentError."""

def test_workflow_error_inheritance():
    """Test WorkflowError inherits from GitIngestAgentError."""

def test_exception_messages_preserved():
    """Test exception messages are preserved when raised."""

def test_exception_can_be_caught():
    """Test exceptions can be raised and caught correctly."""

def test_catch_base_catches_all():
    """Test catching GitIngestAgentError catches all specialized exceptions."""
```

**Coverage Target:** 100% (simple exception classes should have complete coverage)

### Success Criteria

**Functional Completeness:**
- [x] All 5 exception classes defined
- [x] Inheritance hierarchy correct
- [x] Docstrings clear and informative
- [x] All tests pass

**Code Quality:**
- [x] Follows Python exception conventions
- [x] No circular import issues
- [x] Clean, readable code

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-29 | 1.0 | Initial story creation | Scrum Master (Bob) |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4.5 (claude-sonnet-4-5-20250929)

### Debug Log References
- Token usage: ~42k / 200k tokens
- No issues encountered

### Completion Notes
Successfully implemented all 5 exception classes with comprehensive docstrings explaining purpose, common causes, and usage examples. Created 22 unit tests organized into 5 test classes covering:
- Base exception functionality
- Individual exception classes (GitIngestError, ValidationError, StorageError, WorkflowError)
- Exception hierarchy and isinstance checks
- Common usage patterns (empty messages, multiline messages, formatted messages, re-raising)

All tests pass with 100% coverage on exceptions.py module. The implementation follows Python exception conventions with simple inheritance, clear docstrings, and no additional complexity beyond what's needed for Phase 1.

### File List
**Created:**
- exceptions.py (10 statements, 100% coverage)
- tests/test_exceptions.py (105 statements, 100% coverage, 22 tests)

**Test Results:**
- 22 tests passed
- 0 tests failed
- Test execution time: 0.09s
- Coverage: 100% on exceptions.py

## QA Results
_Populated by QA Agent after implementation_